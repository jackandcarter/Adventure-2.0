{\rtf1\ansi\ansicpg1252\cocoartf2865
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx720\tx1440\tx2160\tx2880\tx3600\tx4320\tx5040\tx5760\tx6480\tx7200\tx7920\tx8640\pardirnatural\partightenfactor0

\f0\fs24 \cf0 # Unity Scene Setup & Prefabs\
\
This document describes **what must exist in the Unity project** so that code can hook in cleanly.\
\
## Key Constraint\
\
> **Do NOT generate full UI layouts or Canvas hierarchies at runtime.**  \
> All main UI canvases and layout hierarchies must be created inside the Unity editor and visible there.  \
> Code is allowed to:\
> - Reference these objects via serialized fields.\
> - Toggle visibility (Enable/Disable GameObjects).\
> - Instantiate small UI element prefabs (e.g., list items) under existing layout parents.\
\
## Core Scenes\
\
### 1. `Bootstrap` Scene\
\
Contains:\
\
- `GameBootstrap` GameObject with `GameBootstrap` script.\
- `NetworkClient` GameObject with `NetworkClient` script.\
- `GameStateClient` wrapper (if implemented as MonoBehaviour) or a simple manager script to initialize the non-Mono instance.\
- `InputManager` GameObject.\
- `AudioManager` GameObject.\
- Optionally:\
  - A global UI overlay (for system messages) with a minimal Canvas.\
- Marked `DontDestroyOnLoad`.\
\
### 2. `MainMenu` Scene\
\
Contains:\
\
- Background image or simple environment.\
- `Canvas_MainMenu`:\
  - `Panel_Login`\
    - Username field.\
    - Password field.\
    - Login button.\
  - `Panel_CharacterSelect`\
    - Scroll/list of characters.\
    - Create/delete character buttons.\
  - `Panel_CharacterCreate`\
    - Name field.\
    - Class selection.\
    - Confirm/cancel buttons.\
- `MainMenuUIController`:\
  - Serialized references to:\
    - Panels (GameObjects).\
    - Input fields.\
    - Buttons.\
    - Character list container (ScrollRect + Content transform).\
  - No runtime creation of the main panels.\
\
### 3. `Lobby` Scene\
\
Contains:\
\
- Simple visual representation of a hub area (can be upgraded later).\
- `Canvas_Lobby`:\
  - `Panel_PlayerList`\
    - Shows online players.\
  - `Panel_Party`\
    - Shows current party members.\
  - `Panel_Chat`\
    - Chat log scroll view.\
    - Chat input field & send button.\
  - Buttons:\
    - Create/leave party.\
    - Invite player.\
    - Start dungeon.\
- `LobbyUIController`:\
  - References all relevant UI elements.\
  - Subscribes to lobby and party updates from `GameStateClient`.\
\
### 4. `Dungeon` Scene\
\
Contains:\
\
- Empty root GameObject `DungeonRoot`.\
- Camera with follow script.\
- `DungeonView`:\
  - Responsible for instantiating room prefabs and placing entities.\
- `Canvas_InDungeon`:\
  - HUD:\
    - Local player HP/MP/Trance bars.\
    - Ability hotbar.\
    - Party frames.\
    - Status effect icons.\
  - Panels:\
    - Inventory.\
    - Character sheet.\
    - Settings.\
    - Mini-map.\
    - Dungeon chat.\
- `DungeonHUDController`, `ChatUIController`, etc.\
\
## Prefabs\
\
### 1. Player Prefab: `PlayerCharacter`\
\
Components:\
\
- `SpriteRenderer`\
- `Animator` with 2D animations (idle, walk, attack, cast, etc.)\
- `Rigidbody2D` and `Collider2D` for collisions.\
- Scripts:\
  - `PlayerView`\
  - `NetworkEntityClient`\
  - Local input script (`PlayerInputController`) \'96 enabled only for local player.\
- Fields to hook:\
  - Reference to HP/MP UI elements or events.\
\
### 2. Enemy Prefabs\
\
For each enemy archetype:\
\
- `SpriteRenderer`\
- `Animator`\
- `Rigidbody2D` / `Collider2D`\
- Scripts:\
  - `EnemyView`\
  - `NetworkEntityClient`\
- Enemy data is driven by ScriptableObjects (e.g., `EnemyArchetype`).\
\
### 3. Room Prefabs\
\
Each room prefab includes:\
\
- Tilemap(s) or sprite-based layout.\
- Colliders for walls, pits, etc.\
- `DoorMarker` GameObjects at exits:\
  - `DoorMarker` script with:\
    - `direction` (North, East, South, West).\
- Spawn point markers:\
  - For players and enemy spawn groups (e.g. `SpawnPoint` script with a type field).\
\
Room prefabs are referenced by `RoomTemplate` ScriptableObjects.\
\
### 4. Door Prefab\
\
A standalone door prefab for placement by room templates:\
\
- `SpriteRenderer` / `Animator`\
- Collider:\
  - Solid when closed.\
  - Disabled or trigger when open.\
- `DoorView` script:\
  - `SetOpen(bool)`\
  - `SetLocked(bool)`\
  - Plays appropriate animations and updates collider.\
\
### 5. Chest / Loot Prefab\
\
- `SpriteRenderer` / `Animator`\
- `Collider2D` (trigger).\
- `ChestView` script:\
  - Shows open/closed state.\
  - Highlights on hover.\
- Client receives loot open events from server and then shows VFX.\
\
### 6. UI Element Prefabs\
\
These are **not** full canvases, just pieces:\
\
- `UI_HealthBar`:\
  - Used for player and party frames.\
- `UI_ManaBar`\
- `UI_TranceBar`\
- `UI_AbilityIcon`:\
  - Icon image.\
  - Cooldown overlay.\
  - Keybind label.\
- `UI_ChatMessage`:\
  - Single chat message row.\
\
They are instantiated under pre-existing layout containers (e.g. `PartyFramesContainer`, `ChatLogContent`) but the parent containers themselves are part of the scene UI.\
\
## UI Design Rules (Strict)\
\
- All major panels (login, lobby, HUD, inventory, etc.) must be:\
  - Created and laid out in the editor.\
  - Visible and editable as part of the scene.\
- **Do not** do:\
  - `new GameObject("Canvas")` in code for main UI.\
  - `AddComponent<Canvas>()` for core UI.\
- Allowed:\
  - Instantiate element prefabs under existing `RectTransform` parents.\
  - Enable/disable existing panels to show/hide.\
  - Change text, images, slider values, etc.\
\
## For Codex\
\
Codex should:\
\
1. Create empty scenes:\
   - `Bootstrap`, `MainMenu`, `Lobby`, `Dungeon`.\
2. Create the GameObjects and attach scripts:\
   - `GameBootstrap`, `NetworkClient`, etc.\
3. Create placeholder UI layouts:\
   - Panels with buttons and text to be wired up later.\
4. Make the UI controllers with serialized fields:\
   - No runtime creation of entire layouts.\
5. Ensure `Bootstrap` scene is set as startup scene for Unity.\
}